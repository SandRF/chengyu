var __reflect=this&&this.__reflect||function(e,t,n){e.__class__=t,n?n.push(t):n=[t],e.__types__=e.__types__?n.concat(e.__types__):n},__extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);n.prototype=t.prototype,e.prototype=new n},__awaiter=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(a,i){function o(e){try{c(r.next(e))}catch(t){i(t)}}function s(e){try{c(r["throw"](e))}catch(t){i(t)}}function c(e){e.done?a(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(a)throw new TypeError("Generator is already executing.");for(;c;)try{if(a=1,i&&(o=i[2&n[0]?"return":n[0]?"throw":"next"])&&!(o=o.call(i,n[1])).done)return o;switch(i=0,o&&(n=[0,o.value]),n[0]){case 0:case 1:o=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,i=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(o=c.trys,!(o=o.length>0&&o[o.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){c.label=n[1];break}if(6===n[0]&&c.label<o[1]){c.label=o[1],o=n;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(n);break}o[2]&&c.ops.pop(),c.trys.pop();continue}n=t.call(e,c)}catch(r){n=[6,r],i=0}finally{a=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var a,i,o,s,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},Item_Word=function(e){function t(){var t=e.call(this)||this;return t.skinName="Item_WordSkin",t}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.touchChildren=!1,this.touchEnabled=!0},t}(eui.Component);__reflect(Item_Word.prototype,"Item_Word"),window.Item_Word=Item_Word;var AssetAdapter=function(){function e(){}return e.prototype.getAsset=function(e,t,n){function r(r){t.call(n,r,e)}if(RES.hasRes(e)){var a=RES.getRes(e);a?r(a):RES.getResAsync(e,r,this)}else RES.getResByUrl(e,r,this,RES.ResourceItem.TYPE_IMAGE)},e}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var Main=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(e){}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()};var t=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",t),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.runGame()["catch"](function(e){console.log(e)})},t.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return[4,this.loadResource()];case 1:return t.sent(),this.createGameScene(),[4,platform.login()];case 2:return t.sent(),[4,platform.getUserInfo()];case 3:return e=t.sent(),console.log(e),[2]}})})},t.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n;return __generator(this,function(r){switch(r.label){case 0:return r.trys.push([0,5,,6]),egret.ImageLoader.crossOrigin="anonymous",e=new LoadingUI,this.stage.addChild(e),[4,RES.loadConfig("default.res.json","https://sandrf.github.io/ChengYuWXResource/resource/")];case 1:return r.sent(),[4,this.loadTheme()];case 2:return r.sent(),[4,RES.loadGroup("preload",0,e)];case 3:return r.sent(),this.stage.removeChild(e),t=new LoadingUI,this.stage.addChild(t),[4,SoundManager.Instance];case 4:return r.sent(),[3,6];case 5:return n=r.sent(),console.error(n),[3,6];case 6:return[2]}})})},t.prototype.loadTheme=function(){var e=this;return new Promise(function(t,n){var r=new eui.Theme("resource/default.thm.json",e.stage);r.addEventListener(eui.UIEvent.COMPLETE,function(){t()},e)})},t.prototype.createGameScene=function(){GameData.Instance.getJsonData("questions_json"),SenceManager.Instance.setStage(this),SenceManager.Instance.addSence(SenceManager.Instance.startSence)},t}(eui.UILayer);__reflect(Main.prototype,"Main");var DebugPlatform=function(){function e(){}return e.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,{nickName:"username"}]})})},e.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},e.prototype.soundOnLoadStart=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},e}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var ThemeAdapter=function(){function e(){}return e.prototype.getTheme=function(e,t,n,r){function a(e){t.call(r,e)}function i(t){t.resItem.url==e&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,i,null),n.call(r))}var o=this;if("undefined"!=typeof generateEUI)egret.callLater(function(){t.call(r,generateEUI)},this);else if("undefined"!=typeof generateEUI2)RES.getResByUrl("resource/gameEui.json",function(e,n){window.JSONParseClass.setData(e),egret.callLater(function(){t.call(r,generateEUI2)},o)},this,RES.ResourceItem.TYPE_JSON);else if("undefined"!=typeof generateJSON)if(e.indexOf(".exml")>-1){var s=e.split("/");s.pop();var c=s.join("/")+"_EUI.json";generateJSON.paths[e]?egret.callLater(function(){t.call(r,generateJSON.paths[e])},this):RES.getResByUrl(c,function(n){window.JSONParseClass.setData(n),egret.callLater(function(){t.call(r,generateJSON.paths[e])},o)},this,RES.ResourceItem.TYPE_JSON)}else egret.callLater(function(){t.call(r,generateJSON)},this);else RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,i,null),RES.getResByUrl(e,a,this,RES.ResourceItem.TYPE_TEXT)},e}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var ClearSence=function(e){function t(){var t=e.call(this)||this;return t.skinName="ClearSenceSkin",t}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.btn_nextLevel.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){SoundManager.Instance.play_ef_btnclick(),LevelDataManager.Instance.setCurrentLevel(LevelDataManager.Instance.curLevelID+1),SenceManager.Instance.createGameSence()},this)},t.prototype.init=function(e){this.data=e,this.tip.text=this.data.tip,this.content.text=this.data.content,this.btn_nextLevel.touchEnabled=!0,this.btn_nextLevel.touchChildren=!1},t}(eui.Component);__reflect(ClearSence.prototype,"ClearSence");var GameData=function(){function e(){}return Object.defineProperty(e,"Instance",{get:function(){return this._gameData||(this._gameData=new e),this._gameData},enumerable:!0,configurable:!0}),e.prototype.getJsonData=function(e){this.dataArr=RES.getRes(e)},e}();__reflect(GameData.prototype,"GameData");var GameSence=function(e){function t(){var t=e.call(this)||this;return t.answerArr=[],t.answerNum=4,t.skinName="GameSenceSkin",t}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.init()},t.prototype.init=function(){this.currentID=LevelDataManager.Instance.curLevelID,this.curLevelData=LevelDataManager.Instance.curLevelData,this.img.texture=RES.getRes(this.curLevelData.img);for(var e=0;e<this.answerNum;e++){var t=new Item_Answer;t.scaleX=.7,t.scaleY=.68,this.answerGroup.addChild(t)}for(var n=this.generateWords(),e=0;e<n.length;e++){var t=new Item_Word;t.word.text=n[e],this.wordGroup.addChild(t)}this.addTouchEvents()},t.prototype.generateWords=function(){var e=this.curLevelData.word+this.curLevelData.answer,t=Math.floor(Math.random()*(LevelDataManager.Instance.num_levels-this.currentID)+this.currentID),n=LevelDataManager.Instance.getLevelData(t);return e+=n.word+n.answer,e=this.randomWords(e)},t.prototype.addTouchEvents=function(){this.btn_return.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){SoundManager.Instance.play_ef_btnclick(),SenceManager.Instance.switchSence(SenceManager.Instance.startSence)},this),this.wordGroup.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchGroup,this),this.answerGroup.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchAnswer,this)},t.prototype.removeouchEvents=function(){this.btn_return.removeEventListener(egret.TouchEvent.TOUCH_TAP,function(){SoundManager.Instance.play_ef_btnclick(),SenceManager.Instance.switchSence(SenceManager.Instance.startSence)},this),this.wordGroup.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchGroup,this),this.answerGroup.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchAnswer,this)},t.prototype.randomWords=function(e){for(var t=e.split(""),n="",r=t.length;r>0;r--){var a=Math.floor(Math.random()*t.length);n+=t[a],t.splice(a,1)}return n},t.prototype.onTouchGroup=function(e){if(e.target instanceof Item_Word&&e.target.word.visible){SoundManager.Instance.play_ef_word();for(var t=0;t<this.answerGroup.numChildren;t++){var n=this.answerGroup.getChildAt(t);if(""==n.word.text){n.word.text=e.target.word.text,n.indexFrom=e.target.parent.getChildIndex(e.target),e.target.word.visible=!1,this.answerArr.splice(t,0,n.word.text);break}}this.answerArr.length==this.answerNum&&this.isClear()}},t.prototype.onTouchAnswer=function(e){if(e.target instanceof Item_Word&&""!=e.target.word.text){SoundManager.Instance.play_ef_word(),e.target.word.text="",this.wordGroup.getChildAt(e.target.indexFrom).word.visible=!0;var t=this.answerGroup.getChildIndex(e.target);this.answerArr.splice(t,1)}},t.prototype.isClear=function(){var e=this.answerArr.join("");if(e==this.curLevelData.answer){SoundManager.Instance.play_ef_right(),this.currentID>=LevelDataManager.Instance.total_level&&(LevelDataManager.Instance.total_level=this.currentID+1,egret.localStorage.setItem("total_level",""+LevelDataManager.Instance.total_level));var t=SenceManager.Instance.levelSence.levelsGroup.getChildByName(""+(this.currentID+1));t.setUnlocked(!0),SenceManager.Instance.popClearSence()}else SoundManager.Instance.play_ef_wrong()},t.prototype.resetgameSence=function(){this.currentID=LevelDataManager.Instance.curLevelID,this.curLevelData=LevelDataManager.Instance.curLevelData,this.img.texture=RES.getRes(this.curLevelData.img),console.log(this.curLevelData.img);for(var e=0;e<this.answerNum;e++)this.answerGroup.getChildAt(e).word.text="";for(var t=this.generateWords(),e=0;e<t.length;e++)this.wordGroup.getChildAt(e).word.text=t[e],this.wordGroup.getChildAt(e).word.visible=!0;this.answerArr=[]},t}(eui.Component);__reflect(GameSence.prototype,"GameSence");var LevelDataManager=function(){function e(){this.num_levels=GameData.Instance.dataArr.length,this.total_level=Number(egret.localStorage.getItem("total_level")),0==this.total_level&&(this.total_level=1),this.curLoadGroup=Math.floor(this.total_level/50)+1,console.log(Math.floor(this.total_level/50)+1)}return Object.defineProperty(e,"Instance",{get:function(){return null==this._levelDataManager&&(this._levelDataManager=new e),this._levelDataManager},enumerable:!0,configurable:!0}),e.prototype.getLevelData=function(e){return GameData.Instance.dataArr[e-1]},e.prototype.setCurrentLevel=function(e){this.curLevelID=e,this.curLevelData=this.getLevelData(e)},e}();__reflect(LevelDataManager.prototype,"LevelDataManager");var LoadingUI=function(e){function t(){var t=e.call(this)||this;return t.createView(),t}return __extends(t,e),t.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},t.prototype.onProgress=function(e,t){this.textField.text="Loading..."+e+"/"+t},t}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var SenceManager=function(){function e(){this.startSence=new StartSence,this.levelSence=new LevelSence,this.gameSence=new GameSence,this.clearSence=new ClearSence,this.settingSence=new SettingSence}return Object.defineProperty(e,"Instance",{get:function(){return null==this._senceManager&&(this._senceManager=new e),this._senceManager},enumerable:!0,configurable:!0}),e.prototype.setStage=function(e){null==this._root?this._root=e:console.log("this._root已被设置过,不能重复设置")},e.prototype.addSence=function(e,t){null==t&&(t=this._root),t.addChild(e)},e.prototype.removeSence=function(e){e.parent?e.parent.removeChild(e):(console.log(e),console.log("没有父节点"))},e.prototype.switchSence=function(e,t){null==t&&(t=this._root),t.removeChildren(),t.addChild(e)},e.prototype.popClearSence=function(){this.addSence(this.clearSence),this.clearSence.init(LevelDataManager.Instance.curLevelData)},e.prototype.createGameSence=function(){this._root.removeChildren(),this.addSence(this.gameSence),this.gameSence.resetgameSence()},e}();__reflect(SenceManager.prototype,"SenceManager");var SettingSence=function(e){function t(){var t=e.call(this)||this;return t.skinName="SettingSenceSkin",t}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.init()},t.prototype.init=function(){var e=this;this.btn_bgm.init("btn_music_png"),this.btn_effect.init("btn_sound_png"),this.btn_bgm.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){SoundManager.Instance.play_ef_btnclick(),SoundManager.Instance.isbgmOn=!SoundManager.Instance.isbgmOn,SoundManager.Instance.isbgmOn?e.btn_bgm.currentState="ON":e.btn_bgm.currentState="OFF"},this),this.btn_effect.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){SoundManager.Instance.isEffectOn=!SoundManager.Instance.isEffectOn,SoundManager.Instance.isEffectOn?e.btn_effect.currentState="ON":e.btn_effect.currentState="OFF",SoundManager.Instance.play_ef_btnclick()},this),this.btn_ok.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){SoundManager.Instance.play_ef_btnclick(),SenceManager.Instance.removeSence(SenceManager.Instance.settingSence)},this)},t}(eui.Component);__reflect(SettingSence.prototype,"SettingSence");var SoundManager=function(){function e(){this.isbgmComplete=!1,this.isef_rightComplete=!1,this.isef_wrongComplete=!1,this.isef_btnclickComplete=!1,this.isef_wordComplete=!1,console.log("SoundManager的构造函数"),this.startLoad()}return Object.defineProperty(e,"Instance",{get:function(){return e._manager||(e._manager=new e),e._manager},enumerable:!0,configurable:!0}),e.prototype.startLoad=function(){this.bgm=new egret.Sound,this.bgm=RES.getRes("Music_mp3"),void 0!=this.bgm&&(this.isbgmComplete=!0),this.ef_right=new egret.Sound,this.ef_right=RES.getRes("right_mp3"),void 0!=this.ef_right&&(this.isef_rightComplete=!0),this.ef_wrong=new egret.Sound,this.ef_wrong=RES.getRes("wrong_mp3"),void 0!=this.ef_word&&(this.isef_wrongComplete=!0),this.ef_btnclick=new egret.Sound,this.ef_btnclick=RES.getRes("buttonclick_mp3"),void 0!=this.ef_btnclick&&(this.isef_btnclickComplete=!0),this.ef_word=new egret.Sound,this.ef_word=RES.getRes("type_word_mp3"),void 0!=this.ef_word&&(this.isef_wordComplete=!0)},e.prototype.playbgm=function(){this.isbgmComplete&&this.isbgmOn&&null==this.bgm_channel&&(this.bgm_channel=this.bgm.play(0,0))},e.prototype.stopbgm=function(){this.bgm_channel&&(this.bgm_channel.stop(),this.bgm_channel=null)},Object.defineProperty(e.prototype,"isbgmOn",{get:function(){var e=egret.localStorage.getItem("isbgmOn");return"true"!=e&&e?this._isbgmOn=!1:this._isbgmOn=!0,this._isbgmOn},set:function(e){this._isbgmOn=e,egret.localStorage.setItem("isbgmOn",""+e),e?this.playbgm():this.stopbgm()},enumerable:!0,configurable:!0}),e.prototype.play_ef_right=function(){this.isef_rightComplete&&this.isEffectOn&&this.ef_right.play(0,1)},e.prototype.play_ef_wrong=function(){this.isef_wrongComplete&&this.isEffectOn&&this.ef_wrong.play(0,1)},e.prototype.play_ef_btnclick=function(){this.isef_btnclickComplete&&this.isEffectOn&&this.ef_btnclick.play(0,1)},e.prototype.play_ef_word=function(){this.isef_wordComplete&&this.isEffectOn&&this.ef_word.play(0,1)},Object.defineProperty(e.prototype,"isEffectOn",{get:function(){var e=egret.localStorage.getItem("isEffectOn");return"true"!=e&&e?this._isEffectOn=!1:this._isEffectOn=!0,this._isEffectOn},set:function(e){this._isEffectOn=e,egret.localStorage.setItem("isEffectOn",""+e)},enumerable:!0,configurable:!0}),e}();__reflect(SoundManager.prototype,"SoundManager");var StartSence=function(e){function t(){var t=e.call(this)||this;return t.skinName="StartSenceSkin",t}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.init()},t.prototype.init=function(){SoundManager.Instance.playbgm(),this.btn_start.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){SoundManager.Instance.play_ef_btnclick(),SenceManager.Instance.addSence(SenceManager.Instance.levelSence),SenceManager.Instance.removeSence(SenceManager.Instance.startSence)},this),this.btn_setting.touchEnabled=!0,this.btn_setting.touchChildren=!1,this.btn_setting.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){console.log("点击设置"),SoundManager.Instance.play_ef_btnclick(),SenceManager.Instance.addSence(SenceManager.Instance.settingSence)},this)},t}(eui.Component);__reflect(StartSence.prototype,"StartSence");var Btn_default=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this)},t.prototype.init=function(e){this.img.texture=RES.getRes(e)},t}(eui.Component);__reflect(Btn_default.prototype,"Btn_default"),window.Btn_default=Btn_default;var Btn_level=function(e){function t(t){var n=e.call(this)||this;return n._levelNum=t,n.name=""+n._levelNum,n.skinName="Btn_levelSkin",n}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.init(),this.updateStatus(),this.addTouchEvents()},t.prototype.init=function(){this.btn_on.anchorOffsetX=this.btn_on.width/2,this.btn_on.anchorOffsetY=this.btn_on.height/2,this.btn_on.x=this.btn_on.width/2,this.btn_on.y=this.btn_on.height/2},t.prototype.updateStatus=function(){this._isUnlocked=this._levelNum<=LevelDataManager.Instance.total_level,this._isUnlocked?this.currentState="unLocked":this.currentState="disabled"},t.prototype.setUnlocked=function(e){this._isUnlocked=e,this.updateStatus()},Object.defineProperty(t.prototype,"levelNum",{get:function(){return this._levelNum},enumerable:!0,configurable:!0}),t.prototype.addTouchEvents=function(){var e=this;this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){SoundManager.Instance.play_ef_btnclick(),e._isUnlocked&&(e.currentState="down")},this),this.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){e._isUnlocked&&(e.currentState="unLocked")},this),this.addEventListener(egret.TouchEvent.TOUCH_END,function(){e._isUnlocked?(e.currentState="unLocked",LevelDataManager.Instance.setCurrentLevel(e._levelNum),SenceManager.Instance.createGameSence()):console.log("未解锁关卡: "+e._levelNum)},this)},t}(eui.Component);__reflect(Btn_level.prototype,"Btn_level"),window.Btn_level=Btn_level;var Item_Answer=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this)},t}(Item_Word);__reflect(Item_Answer.prototype,"Item_Answer"),window.Item_Answer=Item_Answer;var LevelSence=function(e){function t(){var t=e.call(this)||this;return t.btnHeight=80,t.levelsGroup=new eui.Group,t.skinName="LevelSenceSkin",t}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.btn_return.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){SoundManager.Instance.play_ef_btnclick(),SenceManager.Instance.switchSence(SenceManager.Instance.startSence)},this),this.init()},t.prototype.init=function(){this.scroll_Group.addChild(this.levelsGroup),this.levelsGroup.height=this.btnHeight*LevelDataManager.Instance.num_levels,this.levelsGroup.width=this.levelScroll.width;var e=new egret.Bitmap;e.texture=RES.getRes("GameBG2_jpg"),e.fillMode=egret.BitmapFillMode.REPEAT,e.height=this.levelsGroup.height,e.scaleX=this.levelsGroup.width/e.width,this.levelsGroup.addChild(e),this.levelScroll.viewport.scrollV=this.levelsGroup.height-this.levelScroll.height,this.levelScroll.bounces=!1,this.levelScroll.verticalScrollBar.autoVisibility=!1,this.levelScroll.verticalScrollBar.visible=!1;for(var t=0;t<LevelDataManager.Instance.num_levels;t++){var n=new Btn_level(t+1);this.levelsGroup.addChild(n),n.y=this.levelsGroup.height-n.height*(t+1),n.x=200*Math.sin(n.y/3/180*Math.PI)+this.levelsGroup.width/3+n.width/2}},t}(eui.Component);__reflect(LevelSence.prototype,"LevelSence");